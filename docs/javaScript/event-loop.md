# 事件循环

`javaScript`的事件循环使它处理异步操作的机制,使得代码可以在单线程环境中执行时处理并发任务.理解事件循环是掌握`javascript`异步编程(如`setTimeout`,`Promise`, `async/await`等)行为的关键

## 事件循环的基本概念

-   1. 单线程模型: `javaScript`是单线程的,这意味着他一次只能处理一个任务.为了实现异步行为,`javascript`使用了事件循环机制
-   2. 调用栈(`Call Stack`): 调用栈是一个后进先出(`LIFO`)的数据结构,存储了所有当前正在执行的函数.当函数调用时,它会被推入栈中;当函数返回时,它会在栈中弹出.
-   3. 消息队列(`Task Queue / Call Queue`): 消息队列是一个队列,存放了异步任务的回调函数(如`setTimeout`,`I/O` 操作等).这些任务在调用栈为空时会被依次处理.
-   4. 微任务队列(`Microtask Queue`): 微任务队列是一个优先级更高的队列,通常用于处理`Promise`的回调.微任务的执行优先级高于宏任务.

## 事件循环的工作流程

### 事件循环的核心是不断重复以下步骤

-   1. 检查调用栈: 如果调用栈不为空,事件循环会持续处理调用栈中的任务.
-   2. 调用栈为空时: 如果调用栈为空,事件循环会检查微任务队列,并依次执行微任务,直到微任务队列为空.
-   3. 执行宏任务: 当调用栈为空且微任务队列也为空时,事件循环会从消息队列中取出第一个宏任务(如`setTimeout`,`setInterval`),将其推入调用栈执行

### 示例

```js
console.log("start"); // 1. 同步任务, 立即执行

setTimeout(() => {
    console.log("Timeout"); // 4. 宏任务, 放入宏任务队列
}, 0);

Promise.resolve().then(() => {
    console.log("Promise"); // 3. 微任务, 放入微任务队列
});
console.log("End"); // 2. 同步任务,立即执行
```

### 关键点

-   微任务优先: 微任务队列中的任务会在每一个宏任务执行完后立即执行.
-   宏任务与微任务的区别: 宏任务包括`setTimeout`,`setInterval`等,而微任务包括`Promise.then`, `MutationObserver`等
-   事件循环时持续运行的: 事件循环会不断地检查调用栈和任务队列,确保`javascript`程序能够在单线程中处理异步操作
